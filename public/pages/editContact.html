<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main.css">
    <title>Editar Contato</title>
</head>

<body>
    <header>
        <h1>Gerenciador de agenda</h1>
    </header>
    <main id="main-form">
        <h2>Editar Contato</h2>
        <form id="form" action="javascript:0">
            <input type="hidden" id="id"  name="id">
            <label for="name">Nome</label>
            <input type="text" id="name" name="name" value="" required>
            <label for="nickname">Apelido</label>
            <input type="text" id="nickname" name="nickname" value="">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" value="" required>
            <label for="whatsapp">Whatsapp</label>
            <input type="text" id="whatsapp" name="whatsapp" value="">

            <button type="button">Atualizar</button>
        </form>
    </main>
    <footer><span><i>Criado por -> Felipe Jhordan Maciel Alves ðŸ¤ </i></span> Data: <span id="data"></span></footer>

    <script src="/js/jquery.min.js"></script>
    <script>

        $(function () {
             const semana = ["Domingo", "Segunda", "TerÃ§a", "Quarta", "Quinta", "Sexta", "SÃ¡bado"]
            let actualDate = new Date()
            $("#data").text(`${semana[actualDate.getDay()]}, ${actualDate.getDate() + 1}/${actualDate.getMonth() + 1}/${actualDate.getFullYear()}`)
            let locationSplit = window.location.href.split("/")
            console.log(locationSplit[locationSplit.length-2])
             $.get(("/contact/"+ locationSplit[locationSplit.length - 2]))
                .done(function (contact) {
                    console.log(contact)
                     $("#name").val(contact.name)
                     $("#email").val(contact.email)
                     $("#nickname").val(contact.nickname)
                     $("#whatsapp").val(contact.whatsapp)
                     $("#id").val(contact.id)
                })
                .fail(function (jqXHR, textStatus, msg) {
                    alert(msg);
                });
            $("button").on("click", (event) => {
                let name = $("#name")
                let email = $("#email")
                if (email.val() == "" || name.val() == "") {
                    if (email.val() == "") alert("Email Ã© obrigatÃ³rio")
                    else alert("Nome Ã© obrigatÃ³rio")
                    return
                }
                let fields = returnFields()
                if (fields?.length != 0) {
                    send(fields)
                }
            })
        })
        let send = ((fields) => {
            $.post("/contacts/edit", { ...fields })
                .done(function (msg) {
                    alert("UsuÃ¡rio atualizado com sucesso")
                })
                .fail(function (jqXHR, textStatus, msg) {
                    alert(msg);
                });
        })
        let returnFields = (() => {
            let x = []
            $('#form input').each((index, elemento) => {
                if ($(elemento).val().trim() != "") {
                    x.length = x.length + 1
                    x[$(elemento).attr('id')] = $(elemento).val();
                }
            })
            console.log(x)
            return x
        })


    </script>
</body>

</html>